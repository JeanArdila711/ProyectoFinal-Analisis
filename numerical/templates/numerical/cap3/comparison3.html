{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Comparaci√≥n de M√©todos de Interpolaci√≥n{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-transparent">
                    <li class="breadcrumb-item"><a href="/" class="text-light">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="/numerical/cap3/" class="text-light">Cap√≠tulo 3</a></li>
                    <li class="breadcrumb-item active text-white">Comparaci√≥n de M√©todos</li>
                </ol>
            </nav>

            <!-- T√≠tulo -->
            <div class="card bg-secondary text-white mb-4">
                <div class="card-body">
                    <h1 class="display-4">Comparaci√≥n de M√©todos de Interpolaci√≥n</h1>
                    <p class="lead">Compara los m√©todos de interpolaci√≥n: Vandermonde, Newton, Lagrange, Spline Lineal y Spline C√∫bico</p>
                </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="card bg-dark text-white mb-4">
                <div class="card-header">
                    <h3>Descripci√≥n</h3>
                </div>
                <div class="card-body">
                    <p>
                        Esta herramienta te permite comparar simult√°neamente los cinco m√©todos de interpolaci√≥n m√°s utilizados 
                        para aproximar funciones a partir de puntos conocidos. Ingresa los puntos (x, y) y obt√©n resultados 
                        comparativos detallados, incluyendo los polinomios interpolantes y an√°lisis de precisi√≥n.
                    </p>
                    <p>
                        <strong>M√©todos incluidos:</strong> Vandermonde, Newton (diferencias divididas), Lagrange, Spline Lineal y Spline C√∫bico.
                    </p>
                </div>
            </div>

            <!-- Formulario de entrada -->
            <div class="card bg-dark text-white mb-4">
                <div class="card-header">
                    <h3>Datos de Entrada</h3>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="x_values" class="form-label">Valores de X (abscisas):</label>
                                <input type="text" 
                                       class="form-control bg-secondary text-white" 
                                       id="x_values" 
                                       name="x_values" 
                                       placeholder="Ejemplo: 0 1 2 3 4"
                                       value="{% if request.POST.x_values %}{{ request.POST.x_values }}{% elif template_data.form_data.x_values %}{{ template_data.form_data.x_values }}{% endif %}"
                                       required>
                                <small class="form-text text-muted">
                                    Separar valores por espacios. Ejemplo: 0 1 2 3 4
                                </small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="y_values" class="form-label">Valores de Y (ordenadas):</label>
                                <input type="text" 
                                       class="form-control bg-secondary text-white" 
                                       id="y_values" 
                                       name="y_values" 
                                       placeholder="Ejemplo: 1 2 4 8 16"
                                       value="{% if request.POST.y_values %}{{ request.POST.y_values }}{% elif template_data.form_data.y_values %}{{ template_data.form_data.y_values }}{% endif %}"
                                       required>
                                <small class="form-text text-muted">
                                    Separar valores por espacios. Debe tener la misma cantidad que X. Ejemplo: 1 2 4 8 16
                                </small>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       id="generate_pdf" 
                                       name="generate_pdf"
                                       {% if request.POST.generate_pdf == 'on' %}checked{% elif template_data.form_data.generate_pdf %}checked{% endif %}>
                                <label class="form-check-label" for="generate_pdf">
                                    <strong>Generar reporte PDF</strong>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-danger btn-lg">
                            Comparar M√©todos
                        </button>
                        <a href="{% url 'chapter3' %}" class="btn btn-outline-light btn-lg ms-2">
                            ‚Üê Volver al Cap√≠tulo 3
                        </a>
                    </form>
                </div>
            </div>

            <!-- Errores de Validaci√≥n -->
            {% if template_data.validations %}
                {% if not template_data.validations.formato.valid %}
                <div class="alert alert-danger" role="alert">
                    <strong>Error de formato:</strong> {{ template_data.validations.formato.message }}
                </div>
                {% endif %}
                {% if not template_data.validations.longitud.valid %}
                <div class="alert alert-danger" role="alert">
                    <strong>Error de longitud:</strong> {{ template_data.validations.longitud.message }}
                </div>
                {% endif %}
            {% endif %}

            <!-- Resultados -->
            {% if template_data.comparison_data and template_data.comparison_data.Interpolaci√≥n %}
            {% with comparison=template_data.comparison_data.Interpolaci√≥n %}
            <div class="card bg-success text-white mb-4">
                <div class="card-header">
                    <h3>Resultados Comparativos</h3>
                </div>
                <div class="card-body">
                    <!-- Tabla de Comparaci√≥n -->
                    <div class="table-responsive">
                        <table class="table table-dark table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>M√©todo</th>
                                    <th>Estado</th>
                                    <th>Polinomio / Ecuaci√≥n</th>
                                    <th>Error</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for method in comparison.methods %}
                                <tr>
                                    <td><strong>{{ method.method }}</strong></td>
                                    <td>
                                        {% if method.status == "Exitoso" %}
                                            <span class="badge bg-success">{{ method.status }}</span>
                                        {% else %}
                                            <span class="badge bg-danger">{{ method.status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small class="font-monospace text-white">
                                            {% if method.polynomial != "N/A" %}
                                                {{ method.polynomial|truncatewords:30 }}
                                            {% else %}
                                                <span class="text-muted">N/A</span>
                                            {% endif %}
                                        </small>
                                    </td>
                                    <td>
                                        {% if method.error != "N/A" %}
                                            {{ method.error|scientific:2 }}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% if method.message %}
                                <tr class="table-info">
                                    <td colspan="4" class="text-dark">
                                        <small><strong>Mensaje:</strong> {{ method.message }}</small>
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- An√°lisis Comparativo -->
                    {% if comparison.analysis and comparison.has_valid_results %}
                    <div class="mt-4">
                        <h4 class="mb-3">An√°lisis Comparativo</h4>
                        
                        <!-- Estad√≠sticas Generales -->
                        <div class="row g-3 mb-3">
                            <div class="col-md-4">
                                <div class="card bg-dark border-info">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-info">M√©todos Exitosos</h5>
                                        <p class="card-text h3">{{ comparison.analysis.total_successful }}/{{ comparison.analysis.total_successful|add:comparison.analysis.total_failed }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-dark border-warning">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-warning">Tasa de √âxito</h5>
                                        <p class="card-text h3">{{ comparison.analysis.success_rate|floatformat:1 }}%</p>
                                    </div>
                                </div>
                            </div>
                            {% if comparison.analysis.most_accurate %}
                            <div class="col-md-4">
                                <div class="card bg-dark border-success">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-success">M√°s Preciso</h5>
                                        <p class="card-text h3">{{ comparison.analysis.most_accurate }}</p>
                                        <small class="text-muted">Menor error</small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Ranking -->
                        {% if comparison.analysis.ranking %}
                        <div class="mt-3">
                            <h5 class="mb-3">üèÜ Ranking de Precisi√≥n:</h5>
                            <div class="table-responsive">
                                <table class="table table-sm table-dark">
                                    <thead>
                                        <tr>
                                            <th>Posici√≥n</th>
                                            <th>M√©todo</th>
                                            <th>Error</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rank in comparison.analysis.ranking %}
                                        <tr>
                                            <td>
                                                {% if rank.position == 1 %}
                                                    
                                                {% elif rank.position == 2 %}
                                                    
                                                {% elif rank.position == 3 %}
                                                    
                                                {% else %}
                                                    {{ rank.position }}¬∞
                                                {% endif %}
                                            </td>
                                            <td><strong>{{ rank.method }}</strong></td>
                                            <td>{{ rank.error|scientific:2 }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}

                        <div class="alert alert-light mt-3">
                            <h6 class="alert-heading">Conclusi√≥n:</h6>
                            <p class="mb-0">{{ comparison.analysis.summary }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Descarga de PDF -->
                    {% if template_data.pdf_path %}
                    <div class="mt-3">
                        <a href="{% url 'download_file' template_data.pdf_path %}" 
                           class="btn btn-light btn-lg" target="_blank">
                            üìÑ Descargar Reporte PDF
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endwith %}
            {% endif %}

            <!-- Ejemplos -->
            <div class="card bg-dark text-white mb-4">
                <div class="card-header">
                    <h3>Ejemplos</h3>
                </div>
                <div class="card-body">
                    <h5>Ejemplo 1: Funci√≥n cuadr√°tica</h5>
                    <ul>
                        <li><strong>Valores X:</strong> 0 1 2 3 4</li>
                        <li><strong>Valores Y:</strong> 1 2 5 10 17</li>
                    </ul>

                    <h5 class="mt-3">Ejemplo 2: Funci√≥n exponencial</h5>
                    <ul>
                        <li><strong>Valores X:</strong> 0 1 2 3 4</li>
                        <li><strong>Valores Y:</strong> 1 2 4 8 16</li>
                    </ul>

                    <h5 class="mt-3">Ejemplo 3: Funci√≥n trigonom√©trica</h5>
                    <ul>
                        <li><strong>Valores X:</strong> 0 0.5 1 1.5 2</li>
                        <li><strong>Valores Y:</strong> 0 0.479 0.841 0.997 0.909</li>
                    </ul>

                    <h5 class="mt-3">Ejemplo 4: Puntos aleatorios</h5>
                    <ul>
                        <li><strong>Valores X:</strong> -2 -1 0 1 2</li>
                        <li><strong>Valores Y:</strong> 4 1 0 1 4</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
